# GitHub Copilot Instructions for De Jong Attractors Project

## Project Overview
This is a Python project for generating Peter de Jong strange attractor images. It's structured as a modular, object-oriented codebase inspired by the Paint-Pours project for consistency and ease of use.

## Architecture & Design Patterns

### Core Components
- `strange_attractor_utilities.py`: Core functionality with StrangeAttractor class
- `strange_attractor_sandbox.py`: User-friendly interface for coefficient control
- `outputs/`: Directory for generated images (gitignored)

### Class Structure
The main class is `StrangeAttractor` which follows these patterns:
- Object-oriented design inspired by Paint-Pours project
- All coefficients stored as instance variables
- Generate method orchestrates the full pipeline
- Modular methods for each step: calculate → process → plot

## API Guidelines

### coefficient Management
- `coefficient_values=None` means random generation (default behavior)
- `coefficient_values=[a, b, c, d]` for specific attractor coefficients
- `coefficient_max=10` controls random coefficient range (±10)
- No seed system - use specific coefficient values for reproducibility

### Image Processing
- `gauss_smoothing=0.5` for smoothing (0 = no smoothing)
- `image_resolution=[width, height]` in pixels
- `timesteps=1e7` for calculation steps (higher = better quality)

### Output Control
- `save_image=True/False` for disk saving
- `display_image=True/False` for display
- `colormap_name=None` for random, or specify like 'inferno'
- `background_color=None` for lowest colormap value, or specify like 'black'  
- `use_parallel=True` for automatic multi-core processing (default)
- `output_directory='outputs/'` for save location

## Code Style & Conventions

### Naming Patterns
- Filenames start with colormap name: `{colormap}-{timesteps}steps-{a}-{b}-{c}-{d}.png`
- Class methods use underscore prefix for private: `_initialize_coefficients()`
- Print statements show progress and coefficient values
- Docstrings follow NumPy style

### Error Handling
- Validate `coefficient_values` length = 4
- Check histogram exists before processing
- Graceful handling of bad coefficients

### Performance Considerations
- Use `@njit` decorator for mathematical calculations
- Automatic parallel processing with multiprocessing.Pool for multiple chunks
- Chunk processing for memory management (`chunk_size=1e7`)
- Gaussian filtering with scipy.ndimage
- Object-oriented matplotlib interface

### Parallel Processing
- Automatically detects available CPU cores with `mp.cpu_count()`
- Uses multiprocessing.Pool for chunk calculations when beneficial
- Falls back to serial processing for single chunks or when disabled
- Each chunk gets random starting points for visual diversity
- Consistent histogram bin edges maintained across all chunks
- Object-oriented matplotlib interface

## Mathematical Context

### Peter de Jong Attractors
```python
x[i] = sin(a * y[i-1]) - cos(b * x[i-1])
y[i] = sin(c * x[i-1]) - cos(d * y[i-1])
```
- coefficients [a, b, c, d] completely define the attractor
- Starting points (0.5, 0.5) don't significantly affect final image
- Log-scale histogram for better visualization

### Image Generation Pipeline
1. **Calculate**: Generate point sequence using numba-optimized function
2. **Histogram**: Create 2D histogram matching image resolution
3. **Process**: Apply log scaling and optional Gaussian smoothing
4. **Render**: Apply colormap and create matplotlib figure

## Common Use Cases

### Quick Exploration
```python
# Generate multiple random images
results = sa_utils.generate_strange_attractor_images(num_images=10)
```

### Specific Recreation
```python
# Recreate exact image using known coefficients
attractor = sa_utils.StrangeAttractor(
    coefficient_values=[2.756, -1.145, 0.502, -4.5],
    colormap_name='viridis'
)
```

### High Quality Export
```python
# 4K wallpaper generation
attractor = sa_utils.StrangeAttractor(
    image_resolution=[3840, 2160],
    timesteps=1e8,
    gauss_smoothing=0.8
)
```

## Development Guidelines

### When Adding Features
- Follow Paint-Pours project patterns for consistency
- Keep utilities separate from user interface
- Maintain backwards compatibility when possible
- Use object-oriented matplotlib (fig, ax pattern)

### Testing Approach
- Test with low resolution/timesteps for speed
- Validate coefficient edge cases
- Check file output and naming
- Verify colormap handling

### Debugging
- Use `show_troubleshooting_plots=True` for intermediate visualizations
- Print coefficient values and timing information
- Check histogram statistics before processing

## Dependencies & Requirements

### Required Libraries
```python
import matplotlib.pyplot as plt
import matplotlib.cm as cm
import numpy as np
from scipy.ndimage import gaussian_filter
from numba import njit
import time
import os
```

### Performance Notes
- Numba compilation happens on first run (slower)
- Memory usage scales with image_resolution * timesteps
- Chunked processing prevents memory overflow
- Typical generation times: 1920x1080 @ 1e7 steps ≈ 30-60 seconds

## Integration Patterns

### With Other Art Projects
- Follow same class structure as Paint-Pours
- Use similar coefficient validation
- Maintain consistent file naming conventions
- Share colormap utilities between projects

### Batch Processing
- Use `generate_strange_attractor_images()` for multiple images
- Each image gets different random coefficients
- Results include both image data and attractor objects
- Supports filtering and post-processing workflows

## Troubleshooting Common Issues

### Memory Problems
- Reduce `timesteps` or `image_resolution`
- Adjust `chunk_size` coefficient
- Close matplotlib figures when not needed

### Visual Quality
- Increase `timesteps` for smoother results
- Adjust `gauss_smoothing` for desired sharpness
- Try different colormaps for better contrast

### coefficient Selection
- Use `coefficient_max` to control exploration range
- Save interesting coefficient combinations
- Some coefficient ranges produce degenerate attractors (points/lines)